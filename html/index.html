<script src="https://unpkg.com/formiojs@latest/dist/formio.full.min.js"></script>

<div id="formio" class="lb"></div>

<div class="button-container"></div>

<script type="text/javascript">
  /**
   * @class LabelBuster
   */
  class LabelBuster {
    /**
     */
    constructor() {
      this.formLocation = 'https://api.forms.platforms.qld.gov.au/fesrqwsyzlbtegd/formwizard';
      this.formElement = {};
      this.formSettings = {
        buttonSettings: {
          showCancel: false,
          showPrevious: false,
          showNext: false,
          showSubmit: false,
        },
      };
      this.wizard = {};
      this.loaded = false;

      window.addEventListener('DOMContentLoaded', () => {
        this.initialise();
      });
    }

    /**
     * @returns {void}
     */
    initialise() {
      this.formElement = document.querySelector('#formio');
      Formio.createForm(this.formElement, this.formLocation, this.formSettings).then((wizard) => {
        this.wizard = wizard;
        this.loaded = true;
      });
    }

    /**
     * @returns {void}
     */
    goToNextPage() {
      if (!this.loaded) {
        this.notLoaded();
      }
      this.wizard.nextPage();
    }

    /**
     * @returns {void}
     */
    acceptEvent() {
      if (this.wizard._data.termsAndConditions) {
        this.wizard.nextPage();
      }
    }

    /**
     * @return {void}
     */
    goToPreviousPage() {
      this.wizard.prevPage();
    }

    /**
     * @returns {void}
     */
    notLoaded() {
      const errorObject = {
        element: this.formElement,
        loaded: this.loaded,
        settings: this.settings,
        name: 'Loaded Exception',
        message: 'FormIO not properly loaded',
      };

      throw errorObject;
    }
  }

  window.label = new LabelBuster();

  // ButtonGroup
  class ButtonGroup {
    constructor(target, formWizard) {
      this.wizard = formWizard;
      this.target = target;
      this.target.innerHTML = this.render();

      document.body.addEventListener('view-change', () => {
        this.target = this.render();
      })
    }

    getPageNo() {
      return this.wizard.page;
    }

    render() {
      if (this.getPageNo() === 1) {
        return startNow();
      }
      if (this.getPageNo() === 13) {
        return finalStep();
      }
      return buttonGroup(this.wizard);
    }
  }

  /**
   * @returns {TemplateString}
   */
  function startNow() {
    return `
        <button ${() => console.log('javascript things!')}>
            Accept things
        </button>
    `
  }

  /**
   * @returns {TemplateString}
   */
  function buttonGroup(wizard) {
    return `
        <div>
            ${button('previous', wizard.prevPage)}
            ${button('next', wizard.nextPage)}
        </div>
    `;
  }

  /**
   * @returns {TemplateString}
   */
  function finalStep() {
    return `
        <div>
            This is the final step
        </div>
    `;
  }

  /**
   * @returns {TemplateString}
   */
  function button(text, pageHandler) {
    return `
        <button onclick=${() => {
        pageHandler && pageHandler();
        fireEvent();
      }}>
            ${text}
        </button>
    `;
  }

  /**
   * @returns {void}
   */
  function fireEvent() {
    const event = new Event('view-change');
    event.dispatchEvent();
  }

  window.buttonGroup = new ButtonGroup(document.querySelector('.button-container'), window.label)
</script>

<style>
  /* .formio-form > div > nav {
    display: none;
} */
</style>
<script>
  /* remove Squiz rendered H1 in favour of H1 for each view from Form.io */
  document.querySelector('#qg-primary-content').removeChild(document.querySelector('h1'));
</script>