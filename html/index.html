
<script src="https://unpkg.com/formiojs@latest/dist/formio.full.min.js"></script>

<div id="formio" class="lb"></div>

<div class="button-container"></div>

<script type="text/javascript">
// Generated code
/* eslint-disable */


/**
 * Render a button
 * @param {String} text the button's inner text
 * @param {function} handler the handler the button should fire on click
 * @param {Boolean} isPrimary indicates whether button is primary
 * @returns {TemplateString}
 */
 function button(text, handler, isPrimary = false) {
  const _button = document.createElement('button');
  _button.innerText = text;
  _button.className = `qg-btn btn-default ${isPrimary && 'primary'}`;
  _button.addEventListener('click', handler);
  return _button;
}

/**
 * @param {Event} domEvent the element's event
 * @param {String} name the name of the custom event
 * @returns {void}
 */
function fireEvent(domEvent, name) {
  const customEvent = new Event(name, { bubbles: true });
  domEvent.target.dispatchEvent(customEvent);
}

/**
 * @return {HTMLElement}
 */
function buttonGroup() {
  const container = document.createElement('div');
  const previous = button(
    'Back',
    e => fireEvent(e, 'labelbusterGoToPrevious'),
    true
  );
  const next = button('Next', e => fireEvent(e, 'labelbusterGoToNext'));
  container.appendChild(previous);
  container.appendChild(next);
  return container;
}

/**
 * @class ButtonGroup
 */
class ButtonGroup {
  constructor(target) {
    this.target = target;
    this.target.appendChild(this.render());

    document.body.addEventListener('labelbusterPageChange', () => {
      this.target = this.render();
    });
  }

  render() {
    return buttonGroup(this);
  }
}

window.buttonGroup = new ButtonGroup(
  document.querySelector('.button-container')
);

/**
 * @param {Boolean} newState checked or not checked
 */
 function modifyAllCheckbox(newState) {
  const accordionArticles = document.querySelectorAll(
    '.qg-accordion article input[type="checkbox"]',
  );
  accordionArticles.forEach((article) => {
    // eslint-disable-next-line no-param-reassign
    article.checked = newState;
  });
}
// Remove before production!
window.addEventListener('labelbusterPageChange', () => {
  const collapse = document.querySelector('label[for="collapse"]');
  const expand = document.querySelector('label[for="expand"]');
  if (collapse) {
    collapse.addEventListener('click', () => {
      modifyAllCheckbox(false);
    });
  }

  if (expand) {
    expand.addEventListener('click', () => {
      modifyAllCheckbox(true);
    });
  }
}, false);
/**
 * @returns {void}
 */
 function firePageChangeEvent() {
  const event = new CustomEvent('labelbusterPageChange', {
    bubbles: true,
    data: {
      page: this.wizard ? this.wizard.page : 0,
    },
  });
  window.dispatchEvent(event);
}

/**
 * @class LabelBuster
 */
const formLocation =
  'https://api.forms.platforms.qld.gov.au/fesrqwsyzlbtegd/formwizard';
class LabelBuster {
  /**
   * @param {Boolean} test if we are running a test
   * @returns {void}
   */
  constructor(test = false) {
    this.formLocation = formLocation;
    this.formElement = {};
    this.formSettings = {
      buttonSettings: {
        showCancel: false,
        showPrevious: false,
        showNext: false,
        showSubmit: false,
      },
    };
    this.wizard = {};
    this.loaded = false;
    this.isTest = test;

    window.addEventListener('DOMContentLoaded', () => {
      if (this.isTest) return;
      this.initialise();
    });

    window.addEventListener('labelbusterGoToNext', () => {
      this.goToNextPage();
    });

    window.addEventListener('labelbusterAccept', () => {
      this.acceptEvent();
    });

    window.addEventListener('labelbusterGoToPrevious', () => {
      this.goToPreviousPage();
    });
  }

  /**
   */
  initialise() {
    this.formElement = document.querySelector('#formio');
    Formio.createForm(
      this.formElement,
      this.formLocation,
      this.formSettings
    ).then(wizard => {
      this.wizard = wizard;
      this.loaded = true;
      firePageChangeEvent();
    });
  }

  /**
   * @return {Boolean}
   */
  goToNextPage() {
    if (!this.loaded) {
      this.notLoaded();
      return false;
    }
    if (this.isTest) {
      return true;
    }
    this.wizard.nextPage().then(() => {
      firePageChangeEvent();
    });
    return true;
  }

  /**
   * @return {Boolean}
   */
  acceptEvent() {
    if (!this.loaded) {
      this.notLoaded();
      return false;
    }
    if (!this.wizard._data.termsAndConditions) return false;
    if (this.isTest) {
      return true;
    }
    this.wizard.nextPage().then(() => {
      firePageChangeEvent();
    });
    return true;
  }

  /**
   * @return {Boolean}
   */
  goToPreviousPage() {
    if (!this.loaded) {
      this.notLoaded();
      return false;
    }
    if (this.isTest) {
      return true;
    }
    this.wizard.prevPage().then(() => {
      firePageChangeEvent();
    });
    return true;
  }

  /**
   */
  notLoaded() {
    const errorObject = {
      element: this.formElement,
      loaded: this.loaded,
      settings: this.settings,
      name: 'Loaded Exception',
      message: 'FormIO not properly loaded',
    };

    throw errorObject;
  }
};

window.label = new LabelBuster();

</script>